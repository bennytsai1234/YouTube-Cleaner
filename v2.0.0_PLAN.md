# YouTube Cleaner v2.0.0 Upgrade Plan & Execution Report

## 1. Executive Summary
**Current Version:** v1.9.9
**Target Version:** v2.0.0
**Status:** üü¢ **Healthy** (All 74 unit tests passed)

This report outlines the roadmap for the major v2.0.0 release. The goal is to solidify the architecture, improve maintainability, and ensure robustness against YouTube's frequent layout changes.

## 2. Audit Findings

### ‚úÖ Strengths
*   **Modular Architecture:** The `src/` directory is well-organized with clear separation of concerns (Core, Features, UI, Data).
*   **Performance:** Utilization of `requestIdleCallback`, `MutationObserver` with debouncing, and CSS-first filtering (`StyleManager`) ensures high performance.
*   **Test Coverage:** Comprehensive logic tests (`logic-test.js`) and filter tests (`filter-test.js`) cover critical paths.
*   **Robustness:** Recent v1.9.x updates have effectively addressed "Safe Pages" (Playlists/Library) and Playlist whitelisting.

### ‚ö†Ô∏è Areas for Improvement (v2.0 Goals)
1.  **Code Coupling:** The `App` class in `main.js` currently handles `patchYouTubeConfig` (Anti-Adblock logic) and `MutationObserver` setup directly. These should be delegated to their respective modules (`AdBlockGuard` and `VideoFilter` or a new `DOMMonitor`).
2.  **Selector Health:** `src/data/selectors.js` is critical. If YouTube changes class names, the script breaks silently. We need a "Debug Health Check" that warns if critical selectors return 0 matches on a populated page.
3.  **Config Management:** `ConfigManager` uses `GM_getValue` directly. As the config grows, we might need a schema validator or migration helper (though strictly not urgent for v2.0, it's good practice).

## 3. v2.0.0 Implementation Plan

### Phase 1: Architectural Refactoring (The "Clean Up")
*   **Task 1.1:** Move `patchYouTubeConfig()` logic from `App` (main.js) to `AdBlockGuard` class.
    *   *Benefit:* Centralizes all Anti-Adblock logic in one place.
*   **Task 1.2:** Encapsulate `MutationObserver` logic.
    *   *Action:* Move the observer setup from `App.init()` into `VideoFilter` or a dedicated `DOMMonitor` class.
    *   *Benefit:* `main.js` becomes a pure "Composition Root", improving readability.

### Phase 2: Reliability Enhancements (The "Shield")
*   **Task 2.1:** Implement `SelectorValidator` (Debug Mode Only).
    *   *Action:* When `DEBUG_MODE` is true, run a check on page load to verify if critical selectors (like `VIDEO_CONTAINERS`, `METADATA.TITLE`) are finding elements. Log warnings if they are dead.
    *   *Benefit:* Faster debugging when YouTube updates their UI.

### Phase 3: Verification & Release
*   **Task 3.1:** Run full test suite (`npm test`).
*   **Task 3.2:** Manual verification of the build (`npm run build`).
*   **Task 3.3:** Update `CHANGELOG.md` with v2.0.0 notes.
*   **Task 3.4:** Bump version in `package.json` and `src/meta.json`.

## 4. Execution Strategy
We will execute these changes iteratively, verifying functionality after each major refactor.

### Next Steps
Awaiting user approval to proceed with **Phase 1: Architectural Refactoring**.
