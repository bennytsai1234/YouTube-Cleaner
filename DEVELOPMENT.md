# å°ˆæ¡ˆé–‹ç™¼æŒ‡å— (Development Guide)

æœ¬æ–‡ä»¶æ•´åˆäº†å°ˆæ¡ˆçš„**æ¶æ§‹èªªæ˜**èˆ‡**æŠ€è¡“æ±ºç­–**ï¼Œæ—¨åœ¨å¹«åŠ©é–‹ç™¼è€…å¿«é€Ÿä¸Šæ‰‹ã€‚

---

## ğŸ—ï¸ 1. è³‡æ–™å¤¾çµæ§‹ (Architecture)

å°ˆæ¡ˆæ¡ç”¨æ¨¡çµ„åŒ–è¨­è¨ˆ (`src/`)ï¼Œæœ€çµ‚é€é `rollup` æ‰“åŒ…æˆå–®ä¸€è…³æœ¬ã€‚

```
src/
â”œâ”€â”€ main.js           # ç¨‹å¼é€²å…¥é» (Entry Point)
â”œâ”€â”€ meta.json         # UserScript Metadata (ç‰ˆæœ¬ã€@matchã€@require)
â”œâ”€â”€ core/             # æ ¸å¿ƒåŸºç¤è¨­æ–½
â”‚   â”œâ”€â”€ config.js     # è¨­å®šç®¡ç† (ConfigManager)
â”‚   â”œâ”€â”€ logger.js     # æ—¥èªŒå°è£ (Logger)
â”‚   â”œâ”€â”€ stats.js      # çµ±è¨ˆè³‡æ–™ (FilterStats)
â”‚   â””â”€â”€ utils.js      # é€šç”¨å·¥å…· (æ•¸å­—è§£æã€æ™‚é–“è¨ˆç®—ã€OpenCC)
â”œâ”€â”€ data/
â”‚   â””â”€â”€ selectors.js  # CSS é¸æ“‡å™¨é›†ä¸­ç®¡ç† (Critical!)
â”œâ”€â”€ features/         # æ¥­å‹™é‚è¼¯æ¨¡çµ„
â”‚   â”œâ”€â”€ video-filter.js    # å½±ç‰‡éæ¿¾æ ¸å¿ƒé‚è¼¯
â”‚   â”œâ”€â”€ style-manager.js   # CSS æ¨£å¼æ³¨å…¥ (é«˜æ•ˆéæ¿¾)
â”‚   â”œâ”€â”€ adblock-guard.js   # åå»£å‘Šå°é–å½ˆçª—è™•ç†
â”‚   â”œâ”€â”€ custom-rules.js    # æ“´å……è¦å‰‡å®šç¾©
â”‚   â””â”€â”€ interaction.js     # äº’å‹•å¢å¼· (å¦‚æ–°åˆ†é é–‹å•Ÿ)
â””â”€â”€ ui/               # ä½¿ç”¨è€…ä»‹é¢
    â”œâ”€â”€ menu.js       # Tampermonkey é¸å–®å¯¦ä½œ
    â””â”€â”€ i18n.js       # å¤šèªè¨€æ”¯æ´ (I18N)
```

**é‹ä½œæµç¨‹**:
1. `main.js`: åˆå§‹åŒ– `ConfigManager` èˆ‡ `StyleManager`ã€‚
2. `StyleManager`: æ³¨å…¥ CSS è¦å‰‡ (First Pass Filter)ã€‚
3. `MutationObserver`: ç›£æ§ DOM è®ŠåŒ–ï¼Œå°‡æ–°å¢å…ƒç´ å‚³éçµ¦ `VideoFilter`ã€‚
4. `VideoFilter`: é€é `utils.js` è§£æå½±ç‰‡è³‡è¨Šï¼Œåˆ¤æ–·æ˜¯å¦éš±è— (Second Pass Filter)ã€‚

---

## ğŸ›ï¸ 2. é—œéµæŠ€è¡“æ±ºç­– (Key Decisions)

### 2.1 CSS å„ªå…ˆç­–ç•¥ (Performance)
**åŸå‰‡**: èƒ½ç”¨ CSS éš±è—çš„å…ƒç´ ï¼Œçµ•ä¸ä½¿ç”¨ JavaScriptã€‚
**åŸå› **: CSS è™•ç†é€Ÿåº¦æ¯” JS å¿« 10-100 å€ï¼Œä¸”èƒ½é¿å…é é¢é–ƒçˆ (FOUC)ã€‚
**å¯¦ä½œ**: `StyleManager` è² è²¬ç”Ÿæˆå‹•æ…‹ CSSï¼Œåªæœ‰ç•¶è¦å‰‡éœ€è¦å…§å®¹åˆ¤æ–· (å¦‚ "è§€çœ‹æ•¸ < 1000") æ™‚æ‰ä½¿ç”¨ JSã€‚

### 2.2 æ··åˆå¼ç›£æ§ (Monitoring)
**å•é¡Œ**: YouTube æ˜¯ SPA (å–®é æ‡‰ç”¨)ï¼Œå…§å®¹å‹•æ…‹è¼‰å…¥ã€‚
**è§£æ³•**:
1. **éœæ…‹è¦å‰‡**: CSS `display: none` (ç«‹å³ç”Ÿæ•ˆ)ã€‚
2. **MutationObserver**: ç›£æ§ DOM æ¨¹è®ŠåŒ– (Debounce è™•ç†)ã€‚
3. **äº‹ä»¶ç›£è½**: ç›£è½ `yt-navigate-finish` è™•ç†é é¢è·³è½‰ã€‚

### 2.3 æœ€å°å¤–éƒ¨ä¾è³´ (Dependencies)
**åŸå‰‡**: æ ¸å¿ƒåŠŸèƒ½é›¶ä¾è³´ï¼Œå¢å¼·åŠŸèƒ½ (å¦‚ç¹ç°¡è½‰æ›) ä½¿ç”¨ CDNã€‚
**åŸå› **: ç¢ºä¿è…³æœ¬è¼•é‡ (<100KB)ã€è¼‰å…¥å¿«é€Ÿï¼Œä¸”åœ¨ CDN å¤±æ•ˆæ™‚ä»èƒ½é‹ä½œ (Graceful Degradation)ã€‚

### 2.4 é¸æ“‡å™¨é›†ä¸­ç®¡ç† (Maintainability)
**åŸå‰‡**: æ‰€æœ‰ CSS Selector å¿…é ˆå®šç¾©åœ¨ `src/data/selectors.js`ã€‚
**åŸå› **: YouTube å‰ç«¯ä»£ç¢¼ç¶“å¸¸è®Šå‹•ã€‚é›†ä¸­ç®¡ç†è®“æˆ‘å€‘èƒ½åœ¨å–®ä¸€æª”æ¡ˆä¸­ä¿®å¾©å¤§éƒ¨åˆ†çš„ DOM è®Šæ›´å•é¡Œã€‚

### 2.5 åŸç”Ÿ UI (Simplicity)
**åŸå‰‡**: ä½¿ç”¨ Tampermonkey åŸç”Ÿé¸å–® (`GM_registerMenuCommand`) èˆ‡ `prompt`/`alert`ã€‚
**åŸå› **: é¿å…æ³¨å…¥è¤‡é›œçš„ React/Vue UI åˆ°é é¢ä¸­ï¼Œæ¸›å°‘èˆ‡ YouTube CSS è¡çªçš„é¢¨éšªï¼Œä¸¦é™ä½ç¶­è­·æˆæœ¬ã€‚

---

## ğŸ§ª 3. æ¸¬è©¦èˆ‡ç™¼å¸ƒ

- **å–®å…ƒæ¸¬è©¦**: `npm test` (ä½¿ç”¨ `test/` ç›®éŒ„ä¸‹çš„è…³æœ¬é©—è­‰é‚è¼¯)ã€‚
- **æ§‹å»º**: `npm run build` (ä½¿ç”¨ rollup æ‰“åŒ…)ã€‚
- **ç™¼å¸ƒ**: ä½¿ç”¨ GitHub Actions è‡ªå‹•ç™¼å¸ƒæ–°ç‰ˆæœ¬åˆ° Release é é¢ã€‚
